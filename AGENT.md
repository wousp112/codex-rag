# AGENT è¾¹ç•Œä¸æ“ä½œæ‰‹å†Œ
- å·¥ä½œè¾¹ç•Œï¼šä»…åœ¨å½“å‰ç›®å½•åŠå­ç›®å½•è¯»å†™ï¼›ç¦æ­¢æ”¹åŠ¨ raw/ å†…å·²æœ‰åŸå§‹æ–‡ä»¶ï¼›ä¸å¾—ä¸Šä¼ å¯†é’¥ã€‚
- å‘½ä»¤ç™½åå•ï¼šrag init/parse/chunk/embed/build-bm25/query/audit/verify-citations/meta set/export-used-sourcesã€‚
- è‡ªç„¶è¯­è¨€â†’å‘½ä»¤æ˜ å°„ï¼šåˆå§‹åŒ–â†’rag initï¼›è§£æâ†’rag parseï¼›åˆ†å—â†’rag chunkï¼›åµŒå…¥â†’rag embedï¼›æ£€ç´¢â†’rag queryï¼›å®¡è®¡â†’rag auditï¼›å¼•æ–‡æ ¸æŸ¥â†’rag verify-citationsã€‚
- ??/??????????????????????????????`GOOGLE_APPLICATION_CREDENTIALS`/`GCP_LOCATION`???? Vertex ??????
- ???????PowerShell??
  `Set-Location "D:\UCL HUD Curriculum\Essay Assistant DEVP0047 Health, Social Justice and the City 2526"; $env:GOOGLE_APPLICATION_CREDENTIALS="D:\UCL HUD Curriculum\Essay Assistant DEVP0047 Health, Social Justice and the City 2526\gcp_credentials.json"; $env:GCP_LOCATION="us-central1"; python -u -m rag embed > meta\embed_run.log 2> meta\embed_run.err`
- Evidence Pack ä»…æ¶ˆè´¹ citable=true æ•°æ®ï¼›å‡ºç° citable=false å¿…é¡»æŠ¥é”™ç»ˆæ­¢ã€‚
- å¤±è´¥å…œåº•ï¼šå¤–éƒ¨ API ç¼ºå¤±æˆ–è°ƒç”¨å¤±è´¥æ—¶ç»™å‡ºæ¸…æ™°æŠ¥é”™ä¸é…ç½®æŒ‡å¼•ï¼Œä¸é™é»˜é™çº§ã€‚
- è¾“å‡ºç‰ˆæœ¬åŒ–ï¼šæ‰€æœ‰ md è¾“å‡ºæŒ‰ vNNN é€’å¢ï¼Œä¸è¦†ç›–æ—§ç‰ˆï¼›è®°å½• meta/version_log.jsonlã€‚
- Instruction Assimilationï¼šå¦‚ raw/instruction/** å­˜åœ¨ï¼Œéœ€ç”Ÿæˆ meta/instruction_brief.md ä¸ meta/style_brief.mdï¼Œå¹¶åœ¨ç´¢å¼•ä¸­æ ‡è®° citable=falseï¼Œç¦æ­¢è¿›å…¥ Evidence Packã€‚

# âœï¸ Drafting Protocol (å†™ä½œåè®®)
- **Evidence First**: Always run `rag query` before drafting any claim. Do not rely on internal memory for specific citations.
- **Handle Missing Evidence**: If no supporting evidence is found in the corpus, **DO NOT HALLUCINATE**. You MUST explicitly tag the sentence with `[EVIDENCE_NEEDED: describe what is missing]` and proceed with the logic.
- **Critical Thinking**: Demonstrate critical engagement. Synthesis evidence instead of just listing it. Analyze conflicts, methodologies, and limitations between different sources.

# ğŸ§  Skill Manifest (æŠ€èƒ½æ¸…å•)
- **Retrieve**: Use `rag query` to find academic evidence and build your argument foundation.
- **Verify**: Use `rag verify-citations` to ensure every citation in your draft correctly points to and supports your claim.
- **Audit**: Use `rag audit` to detect weak assertions, generate a Clean Copy, and track Net Word Count.
- **Learn**: Use `rag parse` when new instructions/rubrics are added to `raw/instruction/` to align with academic standards.

# ğŸ“ Word Count Protocol
- **Ignore Anchors**: When calculating word count for the user, you MUST ignore all citation anchors in the format `{#doc_uid}`.
- **Net Count**: The "Net Word Count" generated by `rag audit` (in the clean copy) is the authoritative figure for submission limits.
# Runtime Logging & Stall Detection
- Embed logs are written to `meta/embed_run.log` (set `RAG_LOG_FILE` to override).
- A live status file is written to `meta/embed_status.json` (set `RAG_STATUS_FILE` to override).
- Heartbeat emits every 10s or every 100 items (whichever comes first).
- If no progress for `RAG_STALL_TIMEOUT` seconds (default 600), embed aborts with a clear error.
- If throughput collapses vs baseline for `RAG_STALL_TIMEOUT` seconds, embed aborts (`RAG_DEGRADE_RATIO=0.05`).
- `rag embed` / `rag embed-one` will auto-open a PowerShell window to tail the log in UTF-8.
